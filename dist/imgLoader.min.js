!function(){function t(t){return g=t,!g.inputId||!g.templates||g.templates.length<1?console.error("You must specify the id of a file input element and at least one job template"):(r=Object.create(v),s=document.getElementById(g.inputId),s.addEventListener("change",e),r)}function e(t){if(r.changeStatus("Loading"),l=t.target.files[0],p.indexOf(l.type)===-1&&r.error)return r.error({id:"UNSUPPORTED_FILE_FORMAT",message:"Unsupported file format"});var e=new FileReader;e.onload=function(t){var e=new Image;e.onload=i,e.src=t.target.result},e.readAsDataURL(t.target.files[0])}function i(t){r.changeStatus("Processing");var e=t.target;c=document.createElement("canvas"),o=c.getContext("2d"),m=document.createElement("canvas"),u=m.getContext("2d");for(var i=0;i<g.templates.length;i++)a(e,g.templates[i]),c.width=0,c.height=0,m.width=0,m.height=0;r.success&&r.success(f),r.changeStatus("Done")}function a(t,e){if(!f[e.id]){var i=Object.create(w);i.template=e,i.canvas=document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),e.displayElementId&&document.getElementById(e.displayElementId).appendChild(i.canvas),f[e.id]=i}f[e.id].inputFile=l;var a=n(t.width,t.height,e.width,e.height,e.method),d=t;if(a.width<t.width/2){var h=t.width,r=t.height;do h=.5*h,r=.5*r,m.width=h,m.height=r,u.drawImage(d,0,0,h,r),d=c,c.width=h,c.height=r,o.drawImage(m,0,0,h,r);while(h>=2*a.width)}f[e.id].canvas.width=a.width,f[e.id].canvas.height=a.height,f[e.id].ctx.drawImage(d,0,0,a.width,a.height)}function n(t,e,i,a,n){return n=n||"fit","fit"==n?d(t,e,i,a):"minfit"==n?h(t,e,i,a):void 0}function d(t,e,i,a){if(t<=i&&e<=a)return{width:t,height:e};var n=t,d=e;return t>e?(n=i,d=i/t*e):(n=a/e*t,d=a),n>i&&(n=i,d=i/t*e),d>a&&(n=a/e*t,d=a),{width:n,height:d}}function h(t,e,i,a){var n=t,d=e;return t>e?(n=a/e*t,d=a):(n=i,d=i/t*e),n<i&&(n=i,d=i/t*e),d<a&&(n=a/e*t,d=a),{width:n,height:d}}window.imgLoader=t;var r,g,s,c,o,m,u,l,f={},p=["image/png","image/jpeg","image/gif","image/bmp","image/svg+xml","image/x-icon","image/webp"],w={getImage:function(t,e){return t||(t="image/png"==this.inputFile.type?"image/png":"image/jpeg"),this.canvas.toDataURL(t,e)}},v={on:function(t,e){return this[t]=e,r},changeStatus:function(t){this.status&&this.status(t)}}}();