!function(){function e(e){return r=e,!r.inputId||!r.templates||r.templates.length<1?console.error("You must specify the id of a file input element and at least one job template"):(d=Object.create(w),g=document.getElementById(r.inputId),g.addEventListener("change",t),d)}function t(e){if(s=e.target.files[0].type,u.indexOf(s)===-1&&d.error)return d.error({id:"UNSUPPORTED_FILE_FORMAT",message:"Unsupported file format"});var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=i,t.src=e.target.result},t.readAsDataURL(e.target.files[0])}function i(e){var t=e.target;h=document.createElement("canvas"),c=h.getContext("2d"),m=document.createElement("canvas"),o=m.getContext("2d");for(var i=0;i<r.templates.length;i++)a(t,r.templates[i]),h.width=0,h.height=0,m.width=0,m.height=0;d.success&&d.success(l)}function a(e,t){if(!l[t.id]){var i=Object.create(p);i.template=t,i.canvas=document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),t.displayElementId&&document.getElementById(t.displayElementId).appendChild(i.canvas),l[t.id]=i}l[t.id].inputType=s;var a=n(e.width,e.height,t.width,t.height),d=e;if(a.width<e.width/2){var r=e.width,g=e.height;do r=.5*r,g=.5*g,m.width=r,m.height=g,o.drawImage(d,0,0,r,g),d=h,h.width=r,h.height=g,c.drawImage(m,0,0,r,g);while(r>=2*a.width)}l[t.id].canvas.width=a.width,l[t.id].canvas.height=a.height,l[t.id].ctx.drawImage(d,0,0,a.width,a.height)}function n(e,t,i,a){if(e<=i&&t<=a)return{width:e,height:t};var n=e,d=t;return e>t?(n=i,d=i/e*t):(n=a/t*e,d=a),n>i&&(n=i,d=i/e*t),d>a&&(n=a/t*e,d=a),{width:n,height:d}}window.imgLoader=e;var d,r,g,h,c,m,o,s,l={},u=["image/png","image/jpeg","image/gif","image/bmp","image/svg+xml","image/x-icon","image/webp"],p={getImage:function(e,t){return e||(e="image/png"==this.inputType?"image/png":"image/jpeg"),this.canvas.toDataURL(e,t)}},w={on:function(e,t){return this[e]=t,d}}}();