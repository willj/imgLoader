!function(){function e(e){return g=e,!g.inputId||!g.templates||g.templates.length<1?console.error("You must specify the id of a file input element and at least one job template"):(d=Object.create(f),h=document.getElementById(g.inputId),h.addEventListener("change",t),d)}function t(e){if(d.changeStatus("Loading"),m=e.target.files[0].type,l.indexOf(m)===-1&&d.error)return d.error({id:"UNSUPPORTED_FILE_FORMAT",message:"Unsupported file format"});var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=a,t.src=e.target.result},t.readAsDataURL(e.target.files[0])}function a(e){d.changeStatus("Processing");var t=e.target;r=document.createElement("canvas"),s=r.getContext("2d"),c=document.createElement("canvas"),o=c.getContext("2d");for(var a=0;a<g.templates.length;a++)i(t,g.templates[a]),r.width=0,r.height=0,c.width=0,c.height=0;d.success&&d.success(u),d.changeStatus("Done")}function i(e,t){if(!u[t.id]){var a=Object.create(p);a.template=t,a.canvas=document.createElement("canvas"),a.ctx=a.canvas.getContext("2d"),t.displayElementId&&document.getElementById(t.displayElementId).appendChild(a.canvas),u[t.id]=a}u[t.id].inputType=m;var i=n(e.width,e.height,t.width,t.height),d=e;if(i.width<e.width/2){var g=e.width,h=e.height;do g=.5*g,h=.5*h,c.width=g,c.height=h,o.drawImage(d,0,0,g,h),d=r,r.width=g,r.height=h,s.drawImage(c,0,0,g,h);while(g>=2*i.width)}u[t.id].canvas.width=i.width,u[t.id].canvas.height=i.height,u[t.id].ctx.drawImage(d,0,0,i.width,i.height)}function n(e,t,a,i){if(e<=a&&t<=i)return{width:e,height:t};var n=e,d=t;return e>t?(n=a,d=a/e*t):(n=i/t*e,d=i),n>a&&(n=a,d=a/e*t),d>i&&(n=i/t*e,d=i),{width:n,height:d}}window.imgLoader=e;var d,g,h,r,s,c,o,m,u={},l=["image/png","image/jpeg","image/gif","image/bmp","image/svg+xml","image/x-icon","image/webp"],p={getImage:function(e,t){return e||(e="image/png"==this.inputType?"image/png":"image/jpeg"),this.canvas.toDataURL(e,t)}},f={on:function(e,t){return this[e]=t,d},changeStatus:function(e){this.status&&this.status(e)}}}();