function imgLoader(e){function t(e){if(m=e.target.files[0].type,u.indexOf(m)===-1&&o.error)return o.error({id:"UNSUPPORTED_FILE_FORMAT",message:"Unsupported file format"});var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=a,t.src=e.target.result},t.readAsDataURL(e.target.files[0])}function a(t){var a=t.target;r=document.createElement("canvas"),g=r.getContext("2d"),h=document.createElement("canvas"),c=h.getContext("2d");for(var n=0;n<e.templates.length;n++)i(a,e.templates[n]),r.width=0,r.height=0,h.width=0,h.height=0;o.success&&o.success(l)}function i(e,t){if(!l[t.id]){var a=Object.create(p);a.template=t,a.canvas=document.createElement("canvas"),a.ctx=a.canvas.getContext("2d"),t.displayElementId&&document.getElementById(t.displayElementId).appendChild(a.canvas),l[t.id]=a}l[t.id].inputType=m;var i=n(e.width,e.height,t.width,t.height),d=e;if(i.width<e.width/2){var s=e.width,o=e.height;do s=.5*s,o=.5*o,h.width=s,h.height=o,c.drawImage(d,0,0,s,o),d=r,r.width=s,r.height=o,g.drawImage(h,0,0,s,o);while(s>=2*i.width)}l[t.id].canvas.width=i.width,l[t.id].canvas.height=i.height,l[t.id].ctx.drawImage(d,0,0,i.width,i.height)}function n(e,t,a,i){if(e<=a&&t<=i)return{width:e,height:t};var n=e,d=t;return e>t?(n=a,d=a/e*t):(n=i/t*e,d=i),n>a&&(n=a,d=a/e*t),d>i&&(n=i/t*e,d=i),{width:n,height:d}}var d,r,g,h,c,m,s={on:function(e,t){return this[e]=t,o}},o=Object.create(s),l={},u=["image/png","image/jpeg","image/gif","image/bmp","image/svg+xml","image/x-icon","image/webp"];if(!e.inputId||!e.templates||e.templates.length<1)return console.error("You must specify the id of a file input element and at least one job template");d=document.getElementById(e.inputId),d.addEventListener("change",t);var p={getImage:function(e,t){return e||(e="image/png"==this.inputType?"image/png":"image/jpeg"),this.canvas.toDataURL(e,t)}};return o}